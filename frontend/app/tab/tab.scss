// Copyright 2024, Command Line Inc.
// SPDX-License-Identifier: Apache-2.0

.tab {
    position: absolute;
    width: 130px;
    height: 100%;
    padding: 0 0 0 0;
    box-sizing: border-box;
    font-weight: bold;
    color: var(--secondary-text-color);
    opacity: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    // Inactive tab: 25% white overlay on tab bar background
    background: rgb(255 255 255 / 0.04);

    // Tab color stripe - shows manual color ONLY (VS Code style top stripe)
    .tab-color-stripe {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        border-radius: 0;
        z-index: var(--zindex-tab-name);
    }

    // Status text colors (VS Code style)
    &.status-running .name {
        color: #3b82f6 !important;
        animation: text-pulse 1.5s ease-in-out infinite;
    }

    &.status-finished .name {
        color: #22c55e !important;
    }

    &.status-stopped .name {
        color: #ef4444 !important;
    }

    &.status-attention .name {
        color: #eab308 !important;
        animation: text-pulse 1.5s ease-in-out infinite;
    }


    &::after {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 1px;
        border-right: 1px solid rgb(from var(--main-text-color) r g b / 0.2);
    }

    .tab-inner {
        position: relative;
        width: calc(100% - 6px);
        height: 100%;
        white-space: nowrap;
        border-radius: 0;
    }

    &.animate {
        transition:
            transform 0.3s ease,
            background-color 0.3s ease-in-out;
    }

    &.active {
        // Active tab: 75% white overlay on tab bar background (brightest)
        background: rgb(255 255 255 / 0.12);
        // Drop shadow and side shadows to distinguish active tab
        box-shadow:
            0 2px 4px rgb(0 0 0 / 0.3),
            inset 1px 0 0 rgb(255 255 255 / 0.06),
            inset -1px 0 0 rgb(255 255 255 / 0.06);

        .tab-inner {
            border-color: transparent;
            border-radius: 0;
        }

        .name {
            color: var(--main-text-color);
            opacity: 1;
        }

        // Always show close button on active tab
        .close {
            visibility: visible;
        }

        & + .tab::after,
        &::after {
            content: none;
        }
    }

    &:first-child::after {
        content: none;
    }

    .tab-name-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate3d(-50%, -50%, 0);
        width: calc(100% - 10px);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
        z-index: var(--zindex-tab-name);
    }

    .name {
        user-select: none;
        font-size: 11px;
        font-weight: 500;
        text-shadow: 0px 0px 4px rgb(from var(--main-bg-color) r g b / 0.25);
        overflow: hidden;
        text-overflow: ellipsis;
        text-align: center;
        // Inactive tabs have more muted text
        opacity: 0.7;

        &.focused {
            outline: none;
            border: 1px solid rgb(from var(--main-text-color) r g b / 0.179);
            padding: 2px 6px;
            border-radius: 2px;
        }
    }

    .wave-button {
        position: absolute;
        top: 50%;
        right: 4px;
        transform: translate3d(0, -50%, 0);
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: var(--zindex-tab-name);
        padding: 1px 2px;
        transition: none !important;
    }

    .close {
        visibility: hidden;
    }
}

// Only apply hover effects when not in nohover mode. This prevents the previously-hovered tab from remaining hovered while a tab view is not mounted.
body:not(.nohover) .tab:hover,
body:not(.nohover) .tab.dragging {
    & + .tab::after,
    &::after {
        content: none;
    }

    // Hover tab: use shared hover variable for consistency with settings panel
    background: var(--hover-bg-color);

    .tab-inner {
        border-color: transparent;
    }
    .close {
        visibility: visible;
        &:hover {
            color: var(--main-text-color);
        }
    }
}

// Active tab hover shouldn't change the background
body:not(.nohover) .tab.active:hover {
    background: rgb(255 255 255 / 0.12);
}

// When in nohover mode, always show the close button on the active tab. This prevents the close button of the active tab from flickering when nohover is toggled.
body.nohover .tab.active .close {
    visibility: visible;
}

@keyframes expandWidthAndFadeIn {
    from {
        width: var(--initial-tab-width);
        opacity: 0;
    }
    to {
        width: var(--final-tab-width);
        opacity: 1;
    }
}

.tab.new-tab {
    animation: expandWidthAndFadeIn 0.1s forwards;
}

@keyframes jigglePinIcon {
    0% {
        transform: rotate(0deg);
        color: inherit;
    }
    10% {
        transform: rotate(-30deg);
        color: rgb(255, 193, 7);
    }
    20% {
        transform: rotate(30deg);
        color: rgb(255, 193, 7);
    }
    30% {
        transform: rotate(-30deg);
        color: rgb(255, 193, 7);
    }
    40% {
        transform: rotate(30deg);
        color: rgb(255, 193, 7);
    }
    50% {
        transform: rotate(-15deg);
        color: rgb(255, 193, 7);
    }
    60% {
        transform: rotate(15deg);
        color: rgb(255, 193, 7);
    }
    70% {
        transform: rotate(-15deg);
        color: rgb(255, 193, 7);
    }
    80% {
        transform: rotate(15deg);
        color: rgb(255, 193, 7);
    }
    90% {
        transform: rotate(0deg);
        color: rgb(255, 193, 7);
    }
    100% {
        transform: rotate(0deg);
        color: inherit;
    }
}

.pin.jiggling i {
    animation: jigglePinIcon 0.5s ease-in-out;
}

@keyframes spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

@keyframes text-pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}
